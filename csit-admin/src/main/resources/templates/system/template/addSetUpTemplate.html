<!DOCTYPE html>
<html lang="zh" xmlns:th="http://www.thymeleaf.org">
<head>
    <title>绑定模板</title>
    <link href="/mould/css/style.css" rel="stylesheet"/>
    <link rel=icon href="/mould/favicon.ico">
    <link  href="/mould/css/bootstrap.min.css" rel="stylesheet">
    <link  href="/mould/js/webUploader/webuploader.css" rel="stylesheet">
    <link  href="/mould/js/toastr/toastr.min.css" rel="stylesheet">
    <link  href="/mould/css/style.css" rel="stylesheet">
    <script type="text/javascript" src="/mould/js/jquery.min.js"></script>
    <script type="text/javascript" src="/mould/js/webUploader/webuploader.js"></script>
    <script type="text/javascript" src="/mould/js/bootstrap.min.js"></script>
    <script type="text/javascript" src="/mould/js/toastr/toastr.min.js"></script>
</head>
<body>
<div class="container-fluid">
    <div class="control_box">
        <div id="bigDiv">
            <canvas id="canvas_box"><p>您的系统不支持此程序!</p></canvas>
        </div>
    </div>

    <div class="nav-btn">
        <button type="button" class="btn btn-primary col-xs-3 change-btn" id="change-btn">[[#{template.title.controlList}]]</button>
    </div>
    <div id="mobile-menu" class="mobile-nav show-nav">
        <ul>
            <li class="header">
                <!--<button class="btn btn-primary" data-toggle="modal" id="query_connect" data-target="#controlModel">
                    批量关联
                </button>
                <button class="btn btn-primary" data-toggle="modal" id="setting_volume" data-target="#volumeModel">
                    容量设置
                </button>-->
            <li>
            </li>
                <table width="100%" id="code_table">
                    <thead>
                    <tr>
                        <td>[[#{template.title.controlName}]]</td>
                        <td class="sb_code">[[#{template.title.equipmentNumber}]]</td>
                        <!--<td class="sb_name">设备名称</td>-->
                        <td class="edit">[[#{public.title.operation}]]</td>
                    </tr>
                    </thead>
                    <tbody>

                    <!--控件内容-->
                    </tbody>
                </table>
            </li>
        </ul>
    </div>
</div>

<!--<div class="modal fade" id="chooseTemplateModel" tabindex="-1" role="dialog" aria-labelledby="chooseTemplateModelLabel"
     aria-hidden="true">
    <div class="modal-dialog" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="chooseTemplateModelLabel">选择模板</h5>
                <button type="button" class="close _close" data-dismiss="modal" aria-label="Close">
                    <span aria-hidden="true">&times;</span>
                </button>
            </div>
            <div class="modal-body">
                <form class="needs-validation">
                    <div class="form-group row">
                        <label for="template_id" class="col-3 col-form-label">选择模板:</label>
                        <div class="col-9">
                            <select id="template_id" class="form-control col-12">

                            </select>
                        </div>
                    </div>
                </form>
                <div class="code_list">

                </div>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary _close" data-dismiss="modal">关闭</button>
                <button type="button" class="btn btn-primary form-submit-0">保存</button>
            </div>
        </div>
    </div>
</div>-->
<!-- Modal for volume -->
<!--<div class="modal fade" id="volumeModel" tabindex="-1" role="dialog" aria-labelledby="volumeModelLabel"
     aria-hidden="true">
    <div class="modal-dialog" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="volumeModelLabel">容量设置</h5>
                <button type="button" class="close _close" data-dismiss="modal" aria-label="Close">
                    <span aria-hidden="true">&times;</span>
                </button>
            </div>
            <div class="modal-body">
                <form class="needs-validation">
                    <div class="form-group row">
                        <label class="col-4 col-form-label" for="system_code">选择系统:</label>
                        <div class="col-8">
                            <select class="form-control col-12" id="system_code">
                                <option value="-1">&#45;&#45;请选择&#45;&#45;</option>
                            </select>
                        </div>
                    </div>
                    <div class="form-group row">
                        <label class="col-4 col-form-label">空闲值区间:</label>
                        <div class="col-8">
                            <div class="row center">
                                <div class="col-5"><input type="number" class="form-control" id="space_min" min="0">
                                </div>
                                ＜N≤
                                <div class="col-5"><input type="number" class="form-control" id="space_max" min="0">
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="form-group row">
                        <label class="col-4 col-form-label">饱和值区间:</label>
                        <div class="col-8">
                            <div class="row center">
                                <div class="col-5"><input type="number" class="form-control" id="saturated_min" min="0">
                                </div>
                                ＜N≤
                                <div class="col-5"><input type="number" class="form-control" id="saturated_max" min="0">
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="form-group row">
                        <label class="col-4 col-form-label">超标值区间:</label>
                        <div class="col-8">
                            <div class="row center">
                                <div class="col-5"><input type="number" class="form-control" id="Exceed_min" min="0">
                                </div>
                                ＜N≤
                                <div class="col-5"><input type="number" class="form-control" id="Exceed_max" min="0">
                                </div>
                            </div>
                        </div>
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary _close" data-dismiss="modal">关闭</button>
                <button type="button" class="btn btn-primary form-submit-2">保存</button>
            </div>
        </div>
    </div>
</div>
&lt;!&ndash; Modal for control &ndash;&gt;
<div class="modal fade" id="controlModel" tabindex="-1" role="dialog" aria-labelledby="controlModelLabel"
     aria-hidden="true">
    <div class="modal-dialog" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="controlModelLabel">批量关联</h5>
                <button type="button" class="close _close" data-dismiss="modal" aria-label="Close">
                    <span aria-hidden="true">&times;</span>
                </button>
            </div>
            <div class="modal-body">
                <form class="needs-validation">
                    <div class="form-group row">
                        <label for="equip_type" class="col-3 col-form-label">设备类型:</label>
                        <div class="col-8">
                            <select id="equip_type" class="form-control col-12">

                            </select>
                        </div>
                    </div>
                    <div class="form-group row">
                        <label for="equip_name" class="col-3 col-form-label">设备名称:</label>
                        <div class="col-8">
                            <select id="equip_name" class="form-control col-12">
                                <option value="-1">&#45;&#45;请选择&#45;&#45;</option>
                            </select>
                        </div>
                    </div>
                    <div class="form-group row">
                        <label for="control_position" class="col-3 col-form-label">安装位置:</label>
                        <div class="col-8">
                            <input type="text" class="form-control" id="control_position" value="">
                        </div>
                    </div>
                    <div class="form-group row">
                        <label for="equip_code" class="col-3 col-form-label">设备编码:</label>
                        <div class="col-8">
                            <input type="text" class="form-control" id="equip_code" >
                        </div>
                    </div>
                </form>
                <div class="code_list">

                </div>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-success query_qrcode">查询关联QRCODE</button>
                <button type="button" class="btn btn-secondary _close" data-dismiss="modal">关闭</button>
                <button type="button" class="btn btn-primary form-submit-1">保存</button>
            </div>
        </div>
    </div>
</div>-->

<!-- Modal for editcontrol -->
<div class="modal fade" id="editControlModel" tabindex="-1" role="dialog" aria-labelledby="editControlModelLabel"
     aria-hidden="true">
    <div class="modal-dialog" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="editControlModelLabel">[[#{template.title.controlAssociation}]]</h5>
                <button type="button" class="close _close" data-dismiss="modal" aria-label="Close">
                    <span aria-hidden="true">&times;</span>
                </button>
            </div>
            <div class="modal-body">
                <form class="needs-validation">
                    <div class="form-group row">
                        <!--<label for="equip_type" class="col-3 col-form-label">部门:</label>
                        <div class="col-8">
                            <select id="edit_equip_type" class="form-control col-12">

                            </select>
                        </div>-->
                        <label for="equip_name" class="col-3 col-form-label">[[#{device.title.deptid}]]:</label>
                        <div class="col-8" style="padding: 0px">
                            <div class="input-group" style="width: 300px;margin-left: 15px;">
                                <input id="template_type" name="template_type" type="hidden"/>
                                <input id="deptId" name="deptId" type="hidden"  />
                                <input style="width: 150px" name="treedeptName" onclick="selectDeptTree()" id="treedeptName" type="text" th:placeholder="#{user.title.dept}" class="form-control" required>
                            </div>
                        </div>
                    </div>
                    <div class="form-group row">
                        <label for="equip_name" class="col-3 col-form-label">[[#{template.title.equipmentName}]]:</label>
                        <div class="col-8">
                            <select id="edit_equip_name" class="form-control col-12">
                                <option value="-1">--[[#{template.title.pleaseChoose}]]--</option>
                            </select>
                        </div>
                    </div>
                </form>
                <div class="edit_code_list">

                </div>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-success edit_query_qrcode">[[#{template.title.queryAssociation}]]</button>
                <button type="button" class="btn btn-secondary _close" data-dismiss="modal">[[#{template.title.down}]]</button>
                <button type="button" class="btn btn-primary form-submit-3">[[#{template.title.save}]]</button>
            </div>
        </div>
    </div>
</div>
<th:block th:include="include :: footer" />
</body>
<script type="text/javascript" src="/mould/js/a6.js"></script>
<script type="text/javascript">
    //todo 设置容量 step
    let volume_info = {
        template_id: '',
        space_min: '',
        space_max: '',
        saturated_min: '',
        saturated_max: '',
        Exceed_min: '',
        Exceed_max: '',
        system_code: ''
    };
    let template_type;
    let ids = [];
    let qrcodes = [];
    let one_control_id;
    let upCode;
    let qrcode;
    let template_id;
    let dept_id;
    let Template_Info;

    //todo 获取传参
    function getQuery(name) {
        let query = window.location.search.substring(1);
        let vars = query.split("&");
        for (var i = 0; i < vars.length; i++) {
            let pair = vars[i].split("=");
            if (pair[0] == name) {
                return pair[1];
            }
        }
        return (false);
    }
    window.onload = function () {
        template_id = getQuery('template_id');
        console.log("获取传递的id："+template_id);
        if (template_id) {
            $.ajax({
                url: '/system/template/getTemplateDetailById',
                dataType: 'json',
                type: 'GET',
                data: {'template_id': template_id},
                async: false,
                success: function (res) {
                    if (res[0].Code == 200) {
                        console.log(res[0].data);
                        //todo 如果是房间就不显示容量设置
                        template_type = res[0].data.template_type;
                        Template_Info = res[0].data;
                        //template_type = 'JG';
                        if (template_type == 'FJ') {
                            $("#setting_volume").addClass('hide');
                        }
                        load_template();
                        console.log("aaa:"+Template_Info.width);
                        console.log("aaa:"+Template_Info.height);
                        if(Template_Info.detailList[0].control_name == ""){
                            toastr.error("该模板没有添加任何控件，无法显示");

                        }else{
                            for (var k = 0; k < res[0].data.detailList.length; k++) {
                                ids.push(res[0].data.detailList[k].control_name);
                            }
                            Add_Controls(Template_Info.detailList);
                        }
                        console.log(template_type);
                        upCode = res[0].data.upCode;
                    }
                },
                error: function (error) {
                    toastr.error(error[0].data);
                }
            });
            /*//todo 获取所属部门
            $.ajax({
                url: '/system/template/selectAllSystem',
                dataType: 'json',
                type: 'get',
                success: function (res) {
                    if (res[0].Code == 200) {
                        let _html = '<option value="-1">--请选择--</option>';
                        for (var k = 0; k < res[0].data.length; k++) {
                            _html += '<option value="' + res[0].data[k].dept_id + '">' + res[0].data[k].dept_id + '</option>';
                        }
                        $("#equip_type").html(_html);
                    }
                },
                error: function (error) {
                    //toastr.error(error[0].data);
                }
            });*/
            //todo 查询设备名称
            $.ajax({
                url: '/system/template/getAllAssetTypeInfoList',
                dataType: 'json',
                type: 'post',
                success: function (res) {
                    if (res[0].Code == 200) {
                        //console.log(res[0].data);
                        let _html = '<option value="-1">--请选择--</option>';
                        for (var k = 0; k < res[0].data.length; k++) {
                            _html += "<option value='" + res[0].data[k].device_name + "'>" + res[0].data[k].device_name + "</option>";
                        }
                        $("#equip_name").html(_html);
                    }
                },
                error: function (error) {
                    toastr.error(error[0].data);
                }
            });
        }

        // let template_id = $("#template_id option:selected").val();
        // volume_info.template_id = template_id;

        //显示地图
        /*load_template();
        Add_Controls(Template_Info.detailList);
        console.log("所选择模板编码:"+ids);
        console.log("所选择模板数据:"+Template_Info.detailList);*/
    };



    //todo 编辑控件
    function edit_control(id) {
        //toastr.info("暂未开放");
        console.log(id);
        one_control_id = id;
        // //todo 查询部门
        // $.ajax({
        //     url: '/system/template/getAllSystemList',
        //     dataType: 'json',
        //     type: 'POST',
        //     success: function (res) {
        //         if (res[0].Code == 200) {
        //             //console.log(res[0].data);
        //             let _html = '<option value="-1">--请选择--</option>';
        //             for (var k = 0; k < res[0].data.length; k++) {
        //                 _html += "<option value='" + res[0].data[k].dept_id + "'>" + res[0].data[k].dept_id + "</option>";
        //             }
        //             $("#edit_equip_type").html(_html);
        //         }
        //     },
        //     error: function (error) {
        //         toastr.error(error[0].data);
        //     }
        // });
        //todo 查询设备类型
        $.ajax({
            url: '/system/template/getAllAssetTypeInfoList',
            dataType: 'json',
            type: 'post',
            success: function (res) {
                if (res[0].Code == 200) {
                    //console.log(res[0].data);
                    let _html = '<option value="-1">--请选择--</option>';
                    for (var k = 0; k < res[0].data.length; k++) {
                        _html += "<option value='" + res[0].data[k].device_name + "'>" + res[0].data[k].device_name + "</option>";
                    }
                    $("#edit_equip_name").html(_html);
                }
            },
            error: function (error) {
                toastr.error(error[0].data);
            }
        });
        //todo 获取模板列表
        $.ajax({
            url: '/system/template/getAllTemplateList',
            dataType: 'json',
            type: 'post',
            success: function (res) {
                if (res[0].Code == 200) {
                    let _html = '<option value="-1">--请选择--</option>';
                    for (var k = 0; k < res[0].tempList.length; k++) {
                        _html += '<option value="' + res[0].tempList[k].template_id + '">' + res[0].tempList[k].template_name + '</option>';
                    }
                    $("#edit_template_id").html(_html);
                }
            },
            error: function (error) {
                toastr.error(error[0].data);
            }
        });
        //todo 设置设备编码
        /* $("#edit_equip_code").val(getQuery('qrcode')); */
    }

    //todo 打开控件列表
    $("#change-btn").on('click', function () {
        let menu = $("#mobile-menu");
        if (menu.hasClass("show-nav")) {
            setTimeout(function () {
                menu.addClass("hide-nav").removeClass("show-nav");
            }, 100);
            document.getElementById('change-btn').innerHTML = "关闭";
        } else {
            document.getElementById('change-btn').innerHTML = "控件列表";
            setTimeout(function () {
                menu.addClass("show-nav").removeClass("hide-nav");
            }, 100)
        }
    });

    //todo 单个控件的关联操作 内部的qrcode为内部变量
    $(".form-submit-3").on('click', function () {
        let qrcodes = [];
        let count;
        $(".edit_code_list input:checkbox:checked").each(function (index, item) {
            qrcodes.push($(this).attr('data-code'));
        });
        //保存检验绑定的码是否已经绑定
        $.ajax({
            url: '/system/template/setUpQrCodeByTemplateId',
            dataType: 'json',
            data: {'template_id': getQuery('template_id'),'qrcode': qrcodes[0]},
            type: 'post',
            async:false,
            success: function (res) {
                if (res[0].Code == 200) {
                    count=res[0].data;
                    console.log(count);
                }
            },
            error: function (error) {
                toastr.error(error[0].data);
            }
        });
        if(count>0){
            toastr.error("该编码已绑定控件");
            return;
        }
        if (qrcodes.length > 1) {
            toastr.error("单控件只能选择一个编码");
            return;
        }
        if (qrcodes.length < 1) {
            toastr.error("请选择一个编码");
            return;
        }
        console.log("传入接口的模板id:"+template_id);
        $.ajax({
            type: "POST",
            url: '/system/template/AssociateControl',
            data: {
                "template_id":template_id,
                "qrcode": qrcodes[0],
                "control_name":one_control_id,
            },
            cache: true,
            dataType: "json",
            success: function (res) {
                toastr.success(res[0].data);
                $("._close").click();
                $.ajax({
                    url: '/system/template/getTemplateDetailByMouldCode',
                    dataType: 'json',
                    data: {'template_id': getQuery('template_id')},
                    type: 'post',
                    success: function (res) {
                        if (res[0].Code == 200) {
                            Template_Info = res[0].data;
                            load_template();
                            Refresh_List(Template_Info.detailList);
                            upCode = res[0].data.detailList[0].qrcode;
                        }
                    },
                    error: function (error) {
                        toastr.error(error[0].data);
                    }
                });
            },
            error: function () {
                console.log("发生错误");
            },
            complete: function () {
                console.log("done")
            }
        });
    });



    //todo 根据设备类型、设备名称、安装位置模糊查询Qrcode清单 (针对单个控件)
    $(".edit_query_qrcode").on('click', function () {
        let template_id = $("#edit_template_id option:selected").val();
        let equip_name = $("#edit_equip_name option:selected").val();
        let equip_type = $("#edit_equip_type option:selected").val();
        let control_position = $("#edit_control_position").val();
        let equip_code = $("#edit_equip_code").val();

        if (template_id == '-1') {
            $("#edit_template_id").addClass('is-invalid')
        } else {
            $("#edit_template_id").addClass('is-valid');
        }
        if (equip_name == '-1') {
            $("#edit_equip_name").addClass('is-invalid').attr('placeholder', '请选择设备类型');
        } else {
            $("#edit_equip_name").addClass('is-valid');
        }
        $.ajax({
            url: '/system/template/getQrcodeCheckList',
            dataType: 'json',
            data: {
                'newTypeID': dept_id,
                'newNameID': equip_name
            },
            type: 'post',
            success: function (res) {
                if (res[0].Code == 200) {
                    //console.log(res[0].data);
                    let _html = "";
                    for (var k = 0; k < res[0].data.length; k++) {
                        _html += '<div class="row set-code"><span>' + res[0].data[k].device_code + '</span><input type="checkbox" data-code="' + res[0].data[k].device_code + '"></div>';
                    }
                    $(".edit_code_list").html(_html);
                }
            },
            error: function (error) {
                toastr.error(error[0].data);
            }
        });
    });
    /*用户管理-新增-选择部门树*/
    function selectDeptTree() {
        var treeId = $("#treeDeptId").val();
        var deptId = $.common.isEmpty(treeId) ? "100" : $("#treeDeptId").val();
        var url = ctx + "system/dept/selectDeptTree/" + deptId;
        var options = {
            title: '[[#{device.title.selectmenu}]]',
            width: "380",
            url: url,
            callBack: doSubmitDept
        };
        $.modal.openOptions(options);
    }

    function doSubmitDept(index, layero){
        var body = layer.getChildFrame('body', index);
        $("#deptId").val(body.find('#treeId').val());
        $("#treedeptName").val(body.find('#treeName').val());
        dept_id=$("#deptId").val();
        console.log("部门ID:"+dept_id);
        layer.close(index);
    }

    $("._close").on('click', function () {
        $(".needs-validation input").removeClass('is-invalid').removeClass('is-valid');
        $("#saturated_min").removeAttr('disabled');
        $("#Exceed_min").removeAttr('disabled');
        $(".modal").css('display', 'none').removeClass('show');
    });
    $("#edit_template").on('click', function () {
        $("input").val("");
        $("#fileList").html("");
        $("#template_type").val("-1");
    });

    $(".edit").on('click', function () {
        $("input").val("");
    });


    /*//todo FJ 模板保存
    $(".form-submit-1").on('click', function () {
        qrcodes = [];
        $(".code_list input:checkbox:checked").each(function (index, item) {
            qrcodes.push($(this).attr('data-code'));
        });
        console.log(ids.length, qrcodes.length);
        let dataArr = [];
        if (qrcodes.length > ids.length) {
            toastr.error("请选择小于控件数量的编码");
            return;
        } else {
            ids.sort();
            qrcodes.sort();

            for (var k = 0; k < ids.length; k++) {
                dataArr.push({'control_name': ids[k]});
            }
            for (var i = 0; i < qrcodes.length; i++) {
                dataArr[i].qrcode = qrcodes[i];
            }
        }

        $.ajax({
            type: "POST",
            url: '/system/template/AddCapacityContentDetailUpgradedVersion.html',
            data: {
                "template_id": volume_info.template_id,
                "qrcode": getQuery('qrcode'), //todo 从路径获取
                "system_code": volume_info.system_code,
                "Mould_Size": qrcodes.length, //todo 该模板内控件总数
                "space_min": 0,
                "space_max": 0,
                "saturated_min": 0,
                "saturated_max": 0,
                "Exceed_min": 0,
                "Exceed_max": 0,
                "jsonString": JSON.stringify(dataArr)
            },
            async: false,
            cache: true,
            dataType: "json",
            success: function (res) {
                if(res[0].Code == 200){
                    toastr.success(res[0].data);
                    $("._close").click();
                    $.ajax({
                        url: '/system/template/getTemplateDetailByMouldCode.html',
                        dataType: 'json',
                        data: {'qrcode': getQuery('qrcode')},
                        type: 'GET',
                        success: function (res) {
                            if (res[0].Code == 200) {
                                Template_Info = res[0].data;
                                load_template();
                                Refresh_List(Template_Info.detailList);
                                upCode = res[0].data.upCode;
                            }
                        },
                        error: function (error) {
                            toastr.error(error[0].data);
                        }
                    });
                }else{
                    toastr.error(res[0].data);
                    $("._close").click();
                }
            },
            error: function (error) {
                toastr.error(error[0].data);
            },
            complete: function () {
                console.log("done")
            }
        });
    });*/

    /*//todo QT JG 模板保存
    $(".form-submit-2").on('click', function () {
        console.log(volume_info);
        if (volume_info.template_id == "" || qrcodes == []) {
            toastr.error("请先进行控件关联");
            return;
        }
        let flag1, flag2, flag3, flag4, flag5, flag6, flag7;
        let space_min = $("#space_min").val();
        let space_max = $("#space_max").val();
        let saturated_min = $("#saturated_min").val();
        let saturated_max = $("#saturated_max").val();
        let Exceed_min = $("#Exceed_min").val();
        let Exceed_max = $("#Exceed_max").val();
        let system_code = $("#system_code option:selected").val();
        if (system_code == '-1') {
            flag7 = false;
            $("#system_code").addClass('is-invalid')
        } else {
            flag7 = true;
            volume_info.system_code = system_code;
            $("#system_code").addClass('is-valid');
        }
        if (space_min == '') {
            flag1 = false;
            $("#space_min").addClass('is-invalid').attr('placeholder', '必填项');
        } else {
            flag1 = true;
            volume_info.space_min = space_min;
            $("#space_min").addClass('is-valid');
        }
        if (space_max == '') {
            flag2 = false;
            $("#space_max").addClass('is-invalid').attr('placeholder', '必填项');
        } else {
            flag2 = true;
            volume_info.space_max = space_max;
            $("#space_max").addClass('is-valid');
        }
        if (saturated_min == '') {
            flag3 = false;
            $("#saturated_min").addClass('is-invalid').attr('placeholder', '必填项');
        } else {
            flag3 = true;
            volume_info.saturated_min = saturated_min;
            $("#saturated_min").addClass('is-valid');
        }
        if (saturated_max == '') {
            flag4 = false;
            $("#saturated_max").addClass('is-invalid').attr('placeholder', '必填项');
        } else {
            flag4 = true;
            volume_info.saturated_max = saturated_max;
            $("#saturated_max").addClass('is-valid');
        }
        if (Exceed_min == '') {
            flag5 = false;
            $("#Exceed_min").addClass('is-invalid').attr('placeholder', '必填项');
        } else {
            flag5 = true;
            volume_info.Exceed_min = Exceed_min;
            $("#Exceed_min").addClass('is-valid');
        }
        if (Exceed_max == '') {
            flag6 = false;
            $("#Exceed_max").addClass('is-invalid').attr('placeholder', '必填项');
        } else {
            if (Exceed_max <= Exceed_min) {
                $("#Exceed_max").addClass('is-invalid');
                toastr.warning('必须大于起始值');
            } else {
                flag6 = true;
                volume_info.Exceed_max = Exceed_max;
                $("#Exceed_max").addClass('is-valid');
            }
        }

        if (flag1 && flag2 && flag3 && flag4 && flag5 && flag6 && flag7) {
            ids.sort();
            qrcodes.sort();
            let dataArr = [];
            for (var k = 0; k < qrcodes.length; k++) {
                dataArr.push({'control_name': ids[k]});
            }
            for (var i = 0; i < qrcodes.length; i++) {
                dataArr[i].qrcode = qrcodes[i];
            }
            $.ajax({
                type: "POST",
                url: "/system/template/AddCapacityContentDetailUpgradedVersion.html",
                data: {
                    "template_id": volume_info.template_id,
                    "qrcode": getQuery('qrcode'), //todo 从路径获取
                    "system_code": volume_info.system_code,
                    "Mould_Size": ids.length, //todo 该模板内控件总数
                    "space_min": volume_info.space_min,
                    "space_max": volume_info.space_max,
                    "saturated_min": volume_info.saturated_min,
                    "saturated_max": volume_info.saturated_max,
                    "Exceed_min": volume_info.Exceed_min,
                    "Exceed_max": volume_info.Exceed_max,
                    "jsonString": JSON.stringify(dataArr)
                },
                async: false,
                cache: true,
                dataType: "json",
                success: function (res) {
                    toastr.success(res[0].data);
                    $("._close").click();
                },
                error: function () {
                    console.log("发生错误");
                },
                complete: function () {
                    console.log("done")
                }
            });
        }
    });*/

    /*//todo 根据设备类型、设备名称、安装位置模糊查询Qrcode清单
    $(".query_qrcode").on('click', function () {
        let template_id = $("#template_id option:selected").val();
        volume_info.template_id = template_id;

        let equip_name = $("#equip_name option:selected").val();
        let equip_type = $("#equip_type option:selected").val();
        let control_position = $("#control_position").val();
        let equip_code = $("#equip_code").val();

        if (template_id == '-1') {
            $("#template_id").addClass('is-invalid')
        } else {
            $("#template_id").addClass('is-valid');
        }
        if (equip_name == '-1') {
            $("#equip_name").addClass('is-invalid').attr('placeholder', '请输入设备名称');
        } else {
            $("#equip_name").addClass('is-valid');
        }
        if (equip_type == '-1') {
            $("#equip_type").addClass('is-invalid').attr('placeholder', '请输入设备名称');
        } else {
            $("#equip_type").addClass('is-valid');
        }
        $.ajax({
            url: '/system/template/getQrcodeCheckList.html',
            dataType: 'json',
            data: {
                'newTypeID': equip_type,
                'newNameID': equip_name,
                'newPosition': control_position,
                'newQrCode': equip_code,
                'pageBegin': 0,
                'pageEnd': 1000
            },
            type: 'GET',
            success: function (res) {
                if (res[0].Code == 200) {
                    //console.log(res[0].data);
                    let _html = "";
                    for (var k = 0; k < res[0].data.length; k++) {
                        _html += '<div class="row set-code"><span>' + res[0].data[k].QrCode + '</span><input type="checkbox" data-code="' + res[0].data[k].QrCode + '"></div>';
                    }
                    $(".code_list").html(_html);
                }
            },
            error: function (error) {
                toastr.error(error[0].data);
            }
        });
    });*/

   /* //todo 设置容量区间需要验证
    $("#space_max").on('blur', function () {
        let num = $(this).val();
        //console.log(num);
        let min_num = $("#space_min").val();
        if (num < min_num) {
            toastr.warning('请输入大于初始值的数字');
        } else {
            $("#saturated_min").attr('disabled', 'disabled');
            $("#saturated_min").val(parseInt(num) + 1);
        }
    });

    $("#saturated_max").on('blur', function () {
        let num = $(this).val();
        //console.log(num);
        let min_num = $("#saturated_min").val();
        if (num < min_num) {
            toastr.warning('请输入大于初始值的数字');
        } else {
            $("#Exceed_min").attr('disabled', 'disabled');
            $("#Exceed_min").val(parseInt(num) + 1);
        }
    });*/


</script>
</html>